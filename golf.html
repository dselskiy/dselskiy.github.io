<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<style>
			body,
			html {
				margin: 0;
				padding: 0;
				height: 100%;
				font-family: Arial, sans-serif;
				background-color: #00a3e6;
			}
			.container {
				display: flex;
				flex-direction: column;
				align-items: center;
				text-align: center;
				height: 100%;
			}
			#cascade {
				height: 30%;
				width: auto;
				position: absolute;
				top: 22%;
			}
			#logo {
				width: 20%;
				height: auto;
				position: absolute;
				left: 1%;
				top: 1%;
			}

			.number-of-players {
				color: white;
				background-color: #00a3e6;
				font-size: 30px;
				position: absolute;
				bottom: 260px;
				border-radius: 15px;
				padding: 10px 0px 0px 0px;
				font-weight: bolder;
				border-color: #00a3e6;
			}
			.player-buttons {
				font-size: 45px;
			}
			.player-buttons button {
				font-size: 30px;
				border: none;
				color: transparent;
				text-shadow: 0 0 0 white;
				vertical-align: 5px;
				background: none;
			}
			#startButton {
				font-size: 50px;
				font-weight: bold;
				background-color: white;
				color: #00a3e6;
				border: solid;
				border-radius: 15px;
				cursor: pointer;
				position: fixed;
				bottom: 160px;
				padding: 5px 1px;
				border-color: #00a3e6;
			}
			.bottom-text {
				text-align: center;
				position: fixed;
				bottom: 60px;
				color: white;
			}
			.bottom-text p {
				margin: 5px;
			}
			#resetButton {
				font-size: 30px;
				font-weight: bold;
				background-color: #00a3e6;
				color: white;
				border: none;
				border-radius: 5px;
				cursor: pointer;
				position: fixed;
				bottom: 15px;
			}
			.scorecard-container {
				overflow-x: auto;
				max-width: 100%;
				position: fixed;
				top: 0;
				z-index: 1;
			}
			table {
				border-collapse: collapse;
				width: 100%;
				color: white;
			}
			th,
			td {
				text-align: center;
				padding: 10px;
				font-size: 24px;
			}
			th:first-child,
			td:first-child {
				position: sticky;
				left: 0;
				z-index: 1;
			}
			th:last-child,
			td:last-child {
				position: sticky;
				right: 0;
				background-color: #00a3e6;
				color: white;
				z-index: 1;
			}

			th:last-child {
				background-color: #00a3e6;
				color: white;
			}
			th {
				background-color: #00a3e6;
				color: white;
			}
			.editable-name {
				width: 80px;
				text-align: center;
				border: none;
				background-color: black;
				color: white;
				font-size: 20px;
				text-transform: capitalize;
			}
			.shot-count {
				display: flex;
				align-items: center;
				justify-content: center;
				padding-left: 10px;
				color: white;
			}
			.shot-count button {
				font-size: 30px;
				padding: 10px;
				background-color: black;
				border: none;
				color: white;
			}
			tr:last-child {
				background-color: #00a3e6;
			}
			
		</style>
	</head>

	<body>
		<div class="container">
			<img
				id="cascade"
				src="/images/cascadepicture.png"
				alt="Cascade Putting Course Logo" />

			<a href="https://www.bluemountain.ca/">
				<img
					id="logo"
					src="/images/logo.svg"
					alt="Blue Mountain Logo" />
			</a>

			<div class="number-of-players">
				<label for="playerCount">PLAYERS</label>
				<div class="player-buttons">
					<button onclick="decrementPlayerCount()">➖</button>
					<span id="playerCount" class="player-value">1</span>
					<button onclick="incrementPlayerCount()">➕</button>
				</div>
			</div>
			<button id="startButton" onclick="startGame()">⛳ START ⛳</button>
			<button id="resetButton" onclick="resetGame()">NEW GAME</button>
			<div class="bottom-text">
				<p>built by Dan</p>
				<p>Lost a ball? Ask us for a new one!</p>
				<p>For your safety: stay off rocks and waterways.</p>
			</div>
		</div>

		<script>
			document.getElementById("resetButton").style.display = "none";
			let playerCount = 1;

			// Increase player count
			function incrementPlayerCount() {
				if (playerCount < 6) {
					playerCount++;
					document.getElementById("playerCount").innerText = playerCount;
				}
			}

			// Decrease player count
			function decrementPlayerCount() {
				if (playerCount > 1) {
					playerCount--;
					document.getElementById("playerCount").innerText = playerCount;
				}
			}

			// Start the game and set up the scorecard table
			function startGame() {
				document.getElementById("logo").style.display = "none";
				document.getElementById("cascade").style.display = "none";
				document.querySelector(".number-of-players").style.display = "none";
				document.getElementById("startButton").style.display = "none";
				document.getElementById("resetButton").style.display = "block";
				document.body.style.background = "black";

				const scorecardContainer = document.createElement("div");
				scorecardContainer.classList.add("scorecard-container");

				const table = document.createElement("table");
				const thead = document.createElement("thead");
				const tbody = document.createElement("tbody");

				// Create header row
				const headerRow = document.createElement("tr");
				const nameHeader = document.createElement("th");
				nameHeader.textContent = "HOLE";
				headerRow.appendChild(nameHeader);
				for (let i = 1; i <= 18; i++) {
					const holeHeader = document.createElement("th");
					holeHeader.textContent = `${i}`;
					headerRow.appendChild(holeHeader);
				}
				const totalHeader = document.createElement("th");
				totalHeader.textContent = "TOTAL";
				headerRow.appendChild(totalHeader);
				thead.appendChild(headerRow);

				// Create player rows
				for (let i = 1; i <= playerCount; i++) {
					const playerRow = document.createElement("tr");

					// Create editable player name
					const playerNameCell = document.createElement("td");
					const playerNameInput = document.createElement("input");
					playerNameInput.setAttribute("type", "text");
					playerNameInput.setAttribute("maxlength", "8");
					playerNameInput.classList.add("editable-name");
					playerNameInput.placeholder = `Player ${i}`;
					playerNameInput.addEventListener("input", saveScorecard);
					playerNameCell.appendChild(playerNameInput);
					playerRow.appendChild(playerNameCell);

					// Create shot count cells
					for (let j = 1; j <= 18; j++) {
						const shotCountCell = document.createElement("td");
						const shotCountContainer = document.createElement("div");
						shotCountContainer.classList.add("shot-count");

						// Create decrement button
						const decrementButton = document.createElement("button");
						decrementButton.textContent = "-";
						decrementButton.addEventListener("click", () => {
							decrementShotCount(shotCountContainer);
							saveScorecard();
						});

						// Create shot count display
						const shotCountDisplay = document.createElement("span");
						shotCountDisplay.textContent = "0";
						shotCountContainer.appendChild(decrementButton);
						shotCountContainer.appendChild(shotCountDisplay);

						// Create increment button
						const incrementButton = document.createElement("button");
						incrementButton.textContent = "+";
						incrementButton.addEventListener("click", () => {
							incrementShotCount(shotCountContainer);
							saveScorecard();
						});

						shotCountContainer.appendChild(incrementButton);
						shotCountCell.appendChild(shotCountContainer);
						playerRow.appendChild(shotCountCell);
					}

					// Create total score cell
					const totalCell = document.createElement("td");
					totalCell.textContent = "0";
					playerRow.appendChild(totalCell);

					tbody.appendChild(playerRow);
				}

				// Create "Best Ball" row at the bottom
				const bestBallRow = document.createElement("tr");
				bestBallRow.id = "best-ball-row";

				const bestBallLabelCell = document.createElement("th");
				bestBallLabelCell.textContent = "Best Ball";
				bestBallRow.appendChild(bestBallLabelCell);

				for (let i = 1; i <= 18; i++) {
					const bestBallCell = document.createElement("td");
					bestBallCell.id = `best-ball-hole-${i}`;
					bestBallCell.textContent = "0"; // Default score
					bestBallRow.appendChild(bestBallCell);
				}

				const bestBallTotalCell = document.createElement("td");
				bestBallTotalCell.id = "best-ball-total";
				bestBallTotalCell.textContent = "0"; // Default total score
				bestBallRow.appendChild(bestBallTotalCell);

				tbody.appendChild(bestBallRow); // Append best ball row to tbody

				table.appendChild(thead);
				table.appendChild(tbody);
				scorecardContainer.appendChild(table);
				document.body.appendChild(scorecardContainer);
				loadScorecard();
			}

			// Update total for a player
			function updateTotal(container) {
				const playerRow = container.closest("tr");
				let total = 0;
				const shotCountSpans = playerRow.querySelectorAll(".shot-count span");
				shotCountSpans.forEach((span) => {
					total += parseInt(span.textContent);
				});
				playerRow.lastElementChild.textContent = total;
			}

			// Increment shot count
			function incrementShotCount(container) {
				const shotCountDisplay = container.querySelector("span");
				let count = parseInt(shotCountDisplay.textContent);
				if (count < 6) {
					count++;
					shotCountDisplay.textContent = count;
					updateTotal(container);
					updateBestBall(); // Update best ball after increment
				}
			}

			// Decrement shot count
			function decrementShotCount(container) {
				const shotCountDisplay = container.querySelector("span");
				let count = parseInt(shotCountDisplay.textContent);
				if (count > 0) {
					count--;
					shotCountDisplay.textContent = count;
					updateTotal(container);
					updateBestBall(); // Update best ball after decrement
				}
			}
			
			// Update Best Ball row based on lowest scores for each hole
			function updateBestBall() {
				let bestBallTotal = 0;

				for (let hole = 1; hole <= 18; hole++) {
					let lowestScore = Infinity; // Start with a large number

					// Loop through each player's score for this hole
					document.querySelectorAll("tbody tr").forEach((row) => {
						const shotCountCell = row.querySelector(
							`td:nth-child(${hole + 1}) .shot-count span`
						);
						if (shotCountCell) {
							const score = parseInt(shotCountCell.textContent);
							if (score < lowestScore) {
								lowestScore = score;
							}
						}
					});

					// Update the best ball cell for this hole
					const bestBallCell = document.getElementById(`best-ball-hole-${hole}`);
					bestBallCell.textContent = lowestScore;

					// Add to the total best ball score
					bestBallTotal += lowestScore;
				}

				// Update the best ball total cell
				document.getElementById("best-ball-total").textContent = bestBallTotal;
			}

			// Reset the game and reload the page
			function resetGame() {
				localStorage.removeItem("scorecard");
				window.location.reload();
			}

			// Save scorecard data to local storage
			function saveScorecard() {
				const scorecardData = {
					playerCount: playerCount,
					players: [],
				};

				const rows = document.querySelectorAll("tbody tr");
				rows.forEach((row, index) => {
					const playerName = row.querySelector(".editable-name")?.value || "";
					const total = row.lastElementChild.textContent;
					const scores = Array.from(row.querySelectorAll(".shot-count span")).map(
						(span) => span.textContent
					);

					scorecardData.players.push({
						playerName,
						total,
						scores,
					});
				});

				localStorage.setItem("scorecard", JSON.stringify(scorecardData));
			}

			// Load scorecard data from local storage
			function loadScorecard() {
				const savedScorecard = localStorage.getItem("scorecard");
				if (savedScorecard) {
					const { playerCount: savedPlayerCount, players } = JSON.parse(
						savedScorecard
					);

					playerCount = savedPlayerCount;
					document.getElementById("playerCount").textContent = playerCount;

					const rows = document.querySelectorAll("tbody tr");
					players.forEach((player, index) => {
						const row = rows[index];
						const playerNameInput = row.querySelector(".editable-name");
						if (playerNameInput) {
							playerNameInput.value = player.playerName;
						}

						const shotCountSpans = row.querySelectorAll(".shot-count span");
						player.scores.forEach((score, scoreIndex) => {
							shotCountSpans[scoreIndex].textContent = score;
						});

						row.lastElementChild.textContent = player.total;
					});
				}
			}


		</script>
	</body>
</html>
